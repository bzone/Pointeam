!function(){"use strict";function u(e,a,t,i,o,n){return e=parseInt(e),a=parseInt(a),t=parseInt(t),i=parseInt(i),o=parseInt(o),n=parseInt(n),10*(1e4*(e+31*a+365*t)+60*i+o)+n}var n,e=angular.module("app",["onsen"]),a="wszystkie",o="http://pointeam.com/auth.php?callback=?",s=0,r=0,d="";e.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(a,t,i){var o=e(i.fileModel),n=o.assign;t.bind("change",function(){a.$apply(function(){n(a,t[0].files[0])})})}}}]),e.service("fileUpload",["$http",function(e){this.uploadFileToUrl=function(a,t){var i=new FormData;i.append("file",a),i.append("akuku","laksjf9s8d7ftasiydfgashdfoa8sd7ftasdfgy!siduya8sd7!!s"),e.post(t,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e){window.console&&console.log(e),$.ajax({type:"POST",url:o,data:{file:"http://pointeam.com/"+e.filename,taskId:s,addFileToTask:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){"success"==e||(e="failed")}})}).error(function(e){window.console&&console.log(e)})}}]);var c;c=navigator.userLanguage?navigator.userLanguage:navigator.language?navigator.language:"en",e.filter("logfilter",function(){return function(e,t){return"wszystkie"==a?e:e.filter(function(e,t,i){return e.typ==a})}}),e.filter("trustAsResourceUrl",["$sce",function(e){return function(a){return e.trustAsResourceUrl(a)}}]),e.filter("searchText",function(){return function(e,a){var t=element(by.model("searchText"));return""==t?e.filter(function(e,a,t){return"nie ma takiej mozliwosci"==e.email}):e.filter(function(e,a,i){return e.email==t})}}),e.controller("AppController",function(e,a,t,i,n,s,l){e.user=i.items[0],e.doSomething=function(){setTimeout(function(){ons.notification.alert({message:"tapped"})},100)},e.detectLang=c,e.langpl={sign_in:"Zaloguj się",password:"hasło",or:"lub",create_new_account:"Utwórz nowe konto",forgot_password:"zapomniałeś hasła?",name:"imię",surname:"nazwisko",create_account_and_sign_in:"Utwórz konto i zaloguj",email_connected_to_account:"Podaj adres e-mail powiązany z Twoim kontem.",recovery_on_email:"Na podany adres otrzymasz przypomnienia swojego hasła.",your_email:"Twój e-mail",reset_password:"zresetuj hasło",add_user_with_nfc:"Przypisz użytkownika/ów do tego zadania wykorzystując NFC",start_nfc:"rozpocznij udostępnianie",finished_multi:"ukończonych",task_multi:"zadań",tasks_assigned_to_you:"Zadania przypisane do Ciebie: ",recover_your_email:"Podaj adres e-mail powiązany z Twoim kontem.",recover_your_email_description:"Na podany adres otrzymasz przypomnienia swojego hasła.",your_email_lower_case:"twój e-mail",nfc_description:"Przypisz użytkownika/ów do tego zadania wykorzystując NFC",nfc_share:"rozpocznij udostępnianie",task_not_assigned:" Zadania nieprzypisane: ",closest_date:"  Najbliższy termin: ",tasks_assigned_to_other_people:"zadania przypisane do innych osób",projects:"Projekty",my_tasks:"Moje zadania",informations:"Informacje",comments:"Komentarze",task_description:"Opis zadania",localization:"Lokalizacja: ",end_date_and_priority:"Data ukończenia i priorytet",task_finished:"Zadanie zakończone",priority_low:"Priorytet niski",priority_medium:"Priorytet normalny",priority_high:"Priorytet wysoki",task_budget:"Budżet zadania",done_hours1:"przepracowanych",done_hours2:"godzin",used_money1:"wykorzystane",used_money2:"pieniądze",assigned_people_none:"Przypisane osoby: brak",get_task:"przyjmij zadanie ",assigned_poeple:"Przypisane osoby:",tasks:"Zadania",budget:"Budżet",resources:"Zasoby",progress:"Postęp",statistics:"Statystyki",reported_cost:"Zgłoszony koszt:",cost_accepted:"koszt zaakceptowany",cost_rejected:"koszt odrzucony",cost_rejected:"koszt odrzucony",add_task:"Dodaj zadanie",finished:"zakończone",finished_tasks1:"ukończone",finished_tasks2:"zadania",budget_cost1:"budżet",budget_cost2:"pieniądze",budget_hours1:"budżet",budget_hours2:"godziny",add_resource:"Dodaj zasób",no_reservations:"brak rezerwacji",reservations:"rezerwacje:",change_cost:"Koszty - zmień ",tasks_done1:"wykonanych",tasks_done2:"zadań",not_assigned_tasks:"nieprzypisane zadania",tasks_over_deadline:"zadania po terminie",tasks_over_budget:"zadania z przekroczonym budżetem",all_change:"Wszystko - zmień ",finished_tasks:"Zakończenie zadania:",premium_points_assigned:"Przyznano punkty premiowe: ",new_task:"Nowe zadanie:",project_ending:"Zakończenie projektu",project_start:"Rozpoczęcie projektu",milestone_finish:"Zakończenie milestone",bonus_points:"Punkty premiowe",settings:"Ustawienia",change_avatar:"zmień awatar",modify_personal_data:"Modyfikuj dane osobowe",first_name:"Imię",last_name:"Nazwisko",notifications:"Powiadomienia",notifications_description:"Aktywując powiadomienia, otrzymasz dwa razy dziennie e-mail z podsumowaniem Twoich zadań.",new_project:"Nowy projekt",basic_information:"Informacje podstawowe",name_asterix:"Nazwa*",deadlines:"Terminy",add_deadline:"dodaj termin",your_rate_hour:"Twoja stawka/h",money_budget:"Budżet pieniężny",value:"Wartość",hours_budget:"Budżet godzinowy",new_task2:"Nowe zadanie",description:"Opis",place:"Miejsce",select_localization:"Wybierz lokalizację",deadline_and_priority:"Termin i priorytet",deadline:"Termin",other_date:"Inna data",priority:"Priorytet",low:"Niski",normal:"Normalny",high:"Wysoki",people:"Osoby",add_user:"dodaj osobę",add_user_title:"Dodaj osobę",localization_title:"Lokalizacja",localization_description:"Kliknij na mapie, by wybrać lokalizację",added:"Dodane",add_new:"Dodaj nową",earlier_worked_with:"Ostatnio pracowałeś z:",date:"Data",name_title:"Nazwa",money_title:"Pieniądze",hours_title:"Godziny",resource_information:"Informacje o zasobie",reserve_resource:"Zarezerwuj zasób",select_reservation_date:"Wybierz okres rezerwacji",from:"Od",to:"Do",current_reservations:"Aktualne rezerwacje",report_cost:"Zgłoś koszt",cost_information:"Informacje o koszcie",cost_asterix:"Kwota*",cost_description:"Administrator projektu może zaakceptować, lub odrzucić koszt. Zostaniesz poinformowany o podjętej decyzji.",map_center_at:"Wyśrodkuj mapę na...",search_by_email:"Wyszukaj przez e-mail",new_resource:"Nowy zasób",extra_information:"Dodatkowe informacje",new_cost:"Nowy koszt",account_type:"Typ konta",add_file:"Dodaj plik",added_file:"Dodany plik",text_premium:"Osiągnięto limit osób w projekcie, aby dodać więcej osób zmień konto na Premium.",js_change_cost:"Koszty - zmień ",js_worked_hours:"Przepracowane godziny - zmień ",js_bonus_points:"Punkty premiowe - zmień ",js_reported_cost:"Zgłoszone koszty - zmień ",js_cost_label:"Koszty",js_worked_hours_label:"Przepracowany godziny",js_assigned_tasks_label:"Przypisane zadania",js_bonus_points_label:"Punkty premiowe",js_reported_cost_label:"Zgłoszone koszty",js_budget_type_title:"Opcje projektu",js_budget_type_message:"co chcesz zrobić?"},e.langen={sign_in:"Sign in",password:"password",or:"or",create_new_account:"Create new account",forgot_password:"forgot password?",name:"first name",surname:"last name",create_account_and_sign_in:"Create account and login",email_connected_to_account:"Type in e-mail connected to your account",recovery_on_email:"You will recieve an e-mail with reset password link in just a minute",your_email:"Your e-mail",reset_password:"reset password",add_user_with_nfc:"Assigned users via NFC",start_nfc:"start sharing",finished_multi:"completed",task_multi:"tasks",tasks_assigned_to_you:"Tasks assigned to you: ",recover_your_email:"Type in e-mail connected to your account.",recover_your_email_description:"You will recieve an e-mail with reset password link in just a minute",your_email_lower_case:"your e-mail",nfc_description:"Assigned users via NFC",nfc_share:"start sharing",task_not_assigned:" Unassigned tasks: ",closest_date:"  Closest deadline: ",tasks_assigned_to_other_people:"tasks assigned to other users",projects:"Projects",my_tasks:"My tasks",informations:"Information",comments:"Comments",task_description:"Tasks description",localization:"Localization: ",end_date_and_priority:"Deadline and priority",task_finished:"Task finished",priority_low:"Low priority",priority_medium:"Medium priority",priority_high:"High priority",task_budget:"Task budget",done_hours1:"worked",done_hours2:"hours",used_money1:"money",used_money2:"spent",assigned_people_none:"Assigned users: none",get_task:"take the task ",assigned_poeple:"Assigned users:",tasks:"Tasks",budget:"Budget",resources:"Resources",progress:"Progress",statistics:"Statistics",reported_cost:"Reported cost:",cost_accepted:"cost accepted",cost_rejected:"cost rejected",add_task:"Add a task",finished:"finished",finished_tasks1:"finished",finished_tasks2:"tasks",budget_cost1:"money",budget_cost2:"budget",budget_hours1:"hours",budget_hours2:"budget",add_resource:"Add a resource",no_reservations:"no reservations",reservations:"reservations:",change_cost:"Cost - change ",tasks_done1:"tasks",tasks_done2:"done",not_assigned_tasks:"unassigned tasks",tasks_over_deadline:"tasks after the deadline",tasks_over_budget:"tasks with exceeded budget",all_change:"All - change ",finished_tasks:"Task finish:",premium_points_assigned:"Bonus points assigned: ",new_task:"New task:",project_ending:"Project deadline",project_start:"Project start",milestone_finish:"Milestone deadline",bonus_points:"Bonus points",settings:"Settings",change_avatar:"change avatar",modify_personal_data:"Modify personal data",first_name:"Name",last_name:"Surname",notifications:"Notifications",notifications_description:"With notifications turned on, you will recieve an e-mail with task summary twice a day",new_project:"New project",basic_information:"Basic information",name_asterix:"Name*",deadlines:"Deadlines",add_deadline:"add a deadline",your_rate_hour:"Your rate/h",money_budget:"Money budget",value:"Value",hours_budget:"Hours budget",new_task2:"New task",description:"Description",place:"Place",select_localization:"Select localization",deadline_and_priority:"Deadline and priority",deadline:"Deadline",other_date:"Other date",priority:"Priority",low:"Low",normal:"Normal",high:"High",people:"Users",add_user:"add a user",add_user_title:"Add a user",localization_title:"Localization",localization_description:"Click on the map, to select a localization.",added:"Added",add_new:"Add new",earlier_worked_with:"Recently worked with:",date:"Date",name_title:"Name",money_title:"Money",hours_title:"Hours",resource_information:"Resource information",reserve_resource:"Reserve resource",select_reservation_date:"Select reservation date",from:"From",to:"To",current_reservations:"Current reservations",report_cost:"Report cost",cost_information:"Cost information",cost_asterix:"Cost*",cost_description:"Project administrator can accept or reject reported cost. You will be notified about the decision.",map_center_at:"Center map at...",search_by_email:"Search by e-mail",new_resource:"New resource",extra_information:"Extra information",new_cost:"New cost",account_type:"Account type",add_file:"Add file",added_file:"Added file",text_premium:"Users assigned to project limit has been reached. If you want to add more users change account type to Premium.",js_change_cost:"Cost - change ",js_worked_hours:"Worked hours - change ",js_bonus_points:"Bonus points - change ",js_reported_cost:"Reported costs - change ",js_cost_label:"Costs",js_worked_hours_label:"Worked hours",js_assigned_tasks_label:"Assigned tasks",js_bonus_points_label:"Bonus points",js_reported_cost_label:"Reported costs",js_budget_type_title:"Project options",js_budget_type_message:"what are you up to?"},"pl"==e.detectLang||"pl-PL"==e.detectLang||"pl-pl"==e.detectLang?e.lang=e.langpl:e.lang=e.langen,e.isAndroidTest=function(){var e=navigator.userAgent.toLowerCase(),a=e.indexOf("android")>-1;return a?!0:!1},e.fileSelect=function(){$('label[for="fileU"]').text("Wybrano plik")},e.uploadFile=function(){var a=e.myFile;if(a=$("#fileU").prop("files"),a=a[0],null==a)console.dir(a);else{console.log("file is "),console.dir(a);var t="http://pointeam.com/upload.php";l.uploadFileToUrl(a,t)}},e.addLogElement=function(e,a,t,i,n,s,r,d){$.ajax({type:"POST",url:o,data:{idProjekt:e,idUser:a,typ:t,nazwa:i,osoba:n,avatar:s,data:r,odczytany:d,insertNewLog:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){return e}})},e.showFile=function(a){e.fileUrl=a,navi.pushPage("filedetails.html",{animation:"slide"})},e["switch"]=function(e){e="#"+e,$(e).toggleClass("inactive")},e.checkLogin=function(){if("true"==localStorage.login){$("#spinner").css("display","block"),$("#spinnerIcon").delay(1500).queue(function(e){$(this).hide(),e()}),$("#spinnerOk").delay(1500).queue(function(e){$(this).show(),e()});var a=localStorage.email;e.updateUsersBase(),e.getUserData(a,1)}},e.updateUsersBase=function(){var e="updateUsersBase=";$.ajax({type:"POST",url:o,data:e,crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){n.items=angular.fromJson(e).osoby}})},e.logOut=function(){localStorage.login="false";var e=navi.getPages();3==e.length?(navi.getPages()[2].destroy(),navi.popPage()):(navi.getPages()[3].destroy(),navi.getPages()[2].destroy(),navi.popPage())},e.loginUser=function(){var a=$("#loginEmail").val(),t=$("#loginPassword").val(),i="email="+a+"&password="+t+"&login=";return $.trim(a).length>0&$.trim(t).length>0?$.ajax({type:"POST",url:o,data:i,crossDomain:!0,cache:!1,beforeSend:function(){$("#spinner").css("display","block")},success:function(t){"success"==t?(localStorage.login="true",localStorage.email=a,$("#spinnerIcon").delay(1500).queue(function(e){$(this).hide(),e()}),$("#spinnerOk").delay(1500).queue(function(e){$(this).show(),e()}),e.updateUsersBase(),e.getUserData(a,1)):(t="failed")&&($("#spinner").fadeOut(1e3),ons.notification.alert({message:"Podane dane są niepoprawne. Zapomniałeś hasła ?"}))}}):ons.notification.alert({message:"Podaj e-mail i hasło"}),!1},e.updateUser=function(){var a=e.user.imie,t=e.user.nazwisko,i=e.user.email,n=$("#powiadomieniaOption input").prop("checked");n=n?1:0;var s=$("#capturePhoto").attr("data-avatar");"undefined"==typeof s?s=e.user.avatar:e.user.avatar=s,$.ajax({type:"POST",url:o,data:{imie:a,nazwisko:t,email:i,avatar:s,powiadomienia:n,updateUser:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){"success"==a?(e.user.powiadomienia=n,"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply(),navi.popPage()):(a="failed")&&ons.notification.alert({message:"Podane dane są niepoprawne."})}})},e.registerUser=function(){function a(e){var a=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return a.test(e)}var t=$("#newUserName").val(),i=$("#newUserSurName").val(),n=$("#newUserEmail").val(),s=$("#newUserPassword").val();if(a(n)){var r="imie="+t+"&nazwisko="+i+"&email="+n+"&password="+s+"&signup=";$.trim(t).length>0&$.trim(i).length>0&$.trim(n).length>0&$.trim(s).length>0&&$.ajax({type:"POST",url:o,data:r,crossDomain:!0,cache:!1,beforeSend:function(){$("#spinner").css("display","block")},success:function(a){"success"==a?(localStorage.login="true",localStorage.email=n,$("#spinnerIcon").delay(1500).queue(function(e){$(this).hide(),e()}),$("#spinnerOk").delay(1500).queue(function(e){$(this).show(),e()}),e.getUserData(n,1),e.updateUsersBase()):"exist"==a?(ons.notification.alert({message:"Hey! Już masz konto! możesz się zalogować"}),$("#spinner").fadeOut(1e3),navi.popPage()):"failed"==a&&alert("Something Went wrong")}})}else ons.notification.alert({message:"Podany adres e-mail jest niepoprawny"});return!1},e.recoverPassword=function(){var e=$("#recoverEmail").val(),a="email="+e+"&forget_password=";return $.trim(e).length>0&&$.ajax({type:"POST",url:o,data:a,crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){"invalid"==e?ons.notification.alert({message:"Brak konta powiązanego z tym adresem e-mail"}):(e="success")&&(ons.notification.alert({message:"Twoje hasło zostało wysłane na podany adres e-mail"}),navi.popPage())}}),!1},e.getUserData=function(a,n){var r="email="+a+"&getUserData=";$.ajax({type:"POST",url:o,data:r,crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){$("#spinner").delay(1500).queue(function(r){if(e.user=angular.fromJson(a).user[0],i.items[0]=angular.fromJson(a).user[0],angular.fromJson(a).project){t.items=angular.fromJson(a).project,i.items[0].tasks=angular.fromJson(a).usertasks;t.items.length}window.console&&console.log("pobrano dane uzytkownika"),e.$apply(),angular.forEach(t.items,function(a,t){console.log(a.tytul),$.ajax({type:"POST",url:o,data:{idProjekt:a.idProjekt,getLogData:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(t){a.log=angular.fromJson(t).log,a.log=angular.fromJson(t).log,a.przypisaneOsoby=angular.fromJson(t).osoby,a.zadania=angular.fromJson(t).zadania,a.terminy=angular.fromJson(t).terminy,a.koszty=angular.fromJson(t).koszty,a.zasoby=angular.fromJson(t).zasoby;var i=s("filter")(a.przypisaneOsoby,{idUser:e.user.idUser},!0);a.kasaUzytkownika=i[0].kasaUzytkownika,a.czasUzytkownika=i[0].czasUzytkownika,a.punktyUzytkownika=i[0].punktyUzytkownika;var o=parseInt(a.czasUzytkownika);0==o?(a.statusUzytkownika="oczekuje",a.statusClass="completionHalf"):(a.statusUzytkownika="w trakcie",a.statusClass="completionHalf"),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}})}),$(this).hide(),1==n&&(navi.pushPage("home.html",{animation:"slide"}),e.reloadProjectsGlobal()),2==n&&(navi.popPage(),e.reloadProjectsGlobal()),3==n&&(e.reloadProjectsGlobal(),e.navi.replacePage("procjectview.html",{title:d.tytul})),e.reloadProjectsGlobal(),r()})}})},e.reloadUserData=function(){var a=localStorage.email;e.getUserData(a,2)},e.reloadUserDataGoToProject=function(){var a=localStorage.email;e.getUserData(a,3)},e.reloadProjectsGlobal=function(){e.$root.$broadcast("reloadProjectsEvent")},e.addCommentGlobal=function(){e.$root.$broadcast("addCommentEvent")},e.addUserToTaskGlobal=function(a,t){alert(a),alert(t);var i={userid:a,taskid:t};e.$root.$broadcast("addUserToTaskEvent",i)};var p=!0;e.notifyUser=function(e){p?toast.showShort(e):(statusDiv.innerHTML=e,setTimeout(function(){statusDiv.innerHTML=""},3e3))},e.startNFC=function(a,t){navi.pushPage("nfcShare.html",{animation:"slide"});var i="text/pg",o=String(a);alert(r);var n=ndef.mimeMediaRecord(i,nfc.stringToBytes(o));nfc.share([n],function(){bb10||windowsphone&&e.notifyUser("Sharing Message")},function(e){alert("Failed to share tag "+e),checkbox.checked=!1})},e.stopNFC=function(e,a){nfc.unshare(function(){},function(e){}),navi.popPage()},e.isTaskInProject=function(a,t){$.ajax({type:"POST",url:o,data:{idZadania:t,idProjekt:a,isTaskInProject:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){1==parseInt(a)?(e.addUserToTaskGlobal(e.user.idUser,t),ons.notification.alert({message:"Przypisano Cię do nowego zadania."})):ons.notification.alert({message:"Odebrane zadanie nie jest powiązane z projektem, który masz właśnie otwarty."})}})},e.lisenNFC=function(){function a(a){for(var t=a.tag,i="",o=0;o<t.ndefMessage[0].payload.length;o++)i+=String.fromCharCode(t.ndefMessage[0].payload[o]);e.isTaskInProject(r,parseInt(i))}navi.pushPage("nfcLi.html"),nfc.addMimeTypeListener("text/pg",a,function(){},function(){alert("Fail.")})},e.isAdmin=function(a){var t=!1;return $.ajax({type:"POST",url:o,data:{idProjekt:a,idUser:e.user.idUser,isProjectAdmin:""},async:!1,crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){t=1==parseInt(e)?!0:!1}}),t},e.goToDashboard=function(){$(".page__background").toggleClass("simpleBG"),$(".tabMojeZadania").css("display","none"),$(".tabProjekty").css("display","none"),$(".homeTabs").css("display","none"),$(".tabDashboard").css("overflow","initial"),$(".tabDashboard").css("height","auto"),$("#goToList").css("display","inline-block")},e.goToProjekty=function(){$(".tabMojeZadania").css("display","none"),$(".tabProjekty").css("display","block"),$(".homeTabs").css("display","block"),$(".tabDashboard").css("overflow","hidden"),$(".tabDashboard").css("height","0"),$("#goToList").css("display","none");var a=localStorage.email;e.getUserData(a,0)},e.addProject=function(){var a=0,i=$(".pojedynczyTermin").length;window.console&&console.log("ilosc terminow:"+i);var n=$("#nazwaProjektu").val();if(""==n)ons.notification.alert({message:"Musisz podać nazwę projektu"});else if(0==i)ons.notification.alert({message:"Musisz dodać minimum jeden termin"});else{e.items=t.items;var s=new Date,r=s.getDate(),c=s.getMonth()+1,l=s.getFullYear(),p=s.getHours(),m=s.getMinutes(),y=u(r,c,l,p,m,0);window.console&&console.log("orderKeyToday:"+y),10>r&&(r="0"+r),10>c&&(c="0"+c),10>p&&(p="0"+p),10>m&&(m="0"+m),s=r+"."+c+"."+l+" "+p+":"+m;var z=$("#twojaStawkaGodzinowa select").val(),f=0,k="nie";1==$("#budzetGodzinowy input:checked").length&&(k="tak",f=$("#wartoscBudzetGodziny select").val());var g=0,w="nie";1==$("#budzetPieniadze input:checked").length&&(w="tak",g=$("#wartoscBudzetPieniadze select").val());var v=n.substring(0,15)+"...";$.ajax({type:"POST",url:o,data:{tytul:n,idUser:e.user.idUser,krotkitytul:v,avatarAdmina:e.user.avatar,imie:e.user.imienazwisko,stawka:z,procentUkonczeniaProjektu:0,budzetPieniezny:w,budzetPienieznyWartosc:g,budzetPienieznyWykorzystanie:0,budzetGodzinowy:k,budzetGodzinowyWartosc:f,budzetGodzinowyWykorzystanie:0,ukonczoneZadania:0,wszystkieZadania:0,zadaniaNieprzypisane:0,zadaniaPoTerminie:0,zadaniaPrzekroczonyBudzet:0,insertNewProject:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(b){window.console&&console.log("dodano zadanie");var h=b;e.addLogElement(h,e.user.idUser,"rozpoczecieProjektu","",e.user.imienazwisko,e.user.avatar,s,0);var j={idProjekt:h,idUser:e.user.idUser,tytul:n,krotkitytul:v,avatarAdmina:e.user.avatar,statusUzytkownika:"oczekuje",statusClass:"completionHalf",czasUzytkownika:"00:0",kasaUzytkownika:"0",punktyUzytkownika:"0",procentUkonczeniaProjektu:0,budzetPieniezny:w,budzetPienieznyWartosc:g,budzetPienieznyWykorzystanie:0,budzetGodzinowy:k,budzetGodzinowyWartosc:f,budzetGodzinowyWykorzystanie:0,ukonczoneZadania:0,wszystkieZadania:0,notyfikacjeDisplay:"none",notyfikacje:0,zadaniaPrzypisaneDoUzytkownika:0,zadaniaNieprzypisane:0,zadaniaPoTerminie:0,zadaniaPrzekroczonyBudzet:0,terminy:[],zadania:[],log:[{idLog:0,orderKey:y,typ:"rozpoczecieProjektu",data:s,dataPrezentacja:"Dziś - "+p+":"+m,odczytane:0}],przypisaneOsoby:[{idUser:e.user.idUser,avatar:e.user.avatar,iloscZadan:0,stawka:z,imie:e.user.imie+" "+e.user.nazwisko,czasUzytkownika:0,kasaUzytkownika:0,punktyUzytkownika:0,dodatkowaKlasaListy:"currentUser"}]};t.items.push(j),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply();var P=e.items.length;d=t.items[P-1],$(".pojedynczyTermin").each(function(n){var s=$(this).find('input[type="datetime-local"]').val();console.log(s),r=s.substring(8,10),c=s.substring(5,7),l=s.substring(0,4),p=s.substring(11,13),m=s.substring(14,16),s=r+"."+c+"."+l+" "+p+":"+m;var y=u(r,c,l,p,m,9),z=$(this).find('input[type="text"]').val();$.ajax({type:"POST",url:o,data:{idProjekt:h,orderKey:y,mileStoneNaglowek:"Milestone "+(n+1),data:s,nazwa:z,addNewTerm:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(u){var l=u;$.ajax({type:"POST",url:o,data:{idProjekt:h,idTerminu:l,nazwa:z,opis:"",data:s,dataDzien:r,dataMiesiac:c,dataGodzina:p+":"+m,orderKey:y,basicItem:"none",milestone:"block",mileStoneNaglowek:"Milestone "+(n+1),milestoneUkonczoneZadaniaProcent:0,milestoneWykorzystanyBudzetPieniadze:0,milestoneWykorzystanyBudzetGodziny:0,avatarPierwszejOsoby:"",dodatkoweOsobyDisplay:"none",dotatkoweOsoby:0,ukonczoneDisplay:"none",brakOsobyDisplay:"none",lokalizacjaDisplay:"none",lokalizacja:"none",latLngPosition:"none",priorytet:"none",status:"none",budzetPieniezny:"none",budzetPienieznyWartosc:0,budzetPienieznyWykorzystanie:0,budzetGodzinowy:"none",budzetGodzinowyWartosc:0,budzetGodzinowyWykorzystanie:0,punktyPremiowe:"none",punktyPremioweWartosc:0,addTaskToProject:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(o){var r=o,c={idZadania:r,idTerminu:l,orderKey:y,basicItem:"none",milestone:"block",mileStoneNaglowek:"Milestone "+(n+1),milestoneUkonczoneZadaniaProcent:"0",milestoneWykorzystanyBudzetPieniadze:"0",milestoneWykorzystanyBudzetGodziny:"0",data:s,nazwa:z},u={idTerminu:l,orderKey:y,mileStoneNaglowek:"Milestone "+(n+1),data:s,nazwa:z};t.items[P-1].zadania.push(c),t.items[P-1].terminy.push(u),a++,a==i&&(t.selectedItem=d,e.reloadUserDataGoToProject())}})}})})}})}}}),e.controller("SingleTask",function(e,a,t,i,s,r){e.item=a.selectedTask,e.projekt=a.selectedItem,e.taskOptions=function(a,t,i,o,n,s,r,d){t="none"==t?!1:!0,window.console&&console.log("android: "+a+" ukoncozny: "+t+" userOwner: "+i),d=d==s?!0:!1,a&&!t&&d?ons.notification.confirm({title:"Opcje zadania",message:"co chcesz zrobić?",buttonLabels:["Przypisz zadanie przez NFC","Udostępnij","Timer","Anuluj"],primaryButtonIndex:0,callback:function(a){0==a&&e.startNFC(o,n),1==a&&window.plugins.socialsharing.share("Właśnie pracuję nad przydzielonym mi zadaniem: "+r,null,"http://pointeam.com/pointeamshare.jpg","http://www.pointeam.com"),2==a&&e.startTimer(o,n,s)}}):!t&&i?ons.notification.confirm({title:"Opcje zadania",message:"co chcesz zrobić?",buttonLabels:["Udostępnij","Timer","Anuluj"],primaryButtonIndex:0,callback:function(a){0==a&&window.plugins.socialsharing.share("Właśnie pracuję nad przydzielonym mi zadaniem: "+r,null,"http://pointeam.com/pointeamshare.jpg","http://www.pointeam.com"),1==a&&e.startTimer(o,n,s)}}):window.plugins.socialsharing.share("Właśnie pracuję nad przydzielonym mi zadaniem: "+r,null,"http://pointeam.com/pointeamshare.jpg","http://www.pointeam.com")},e.item.candone=!0;var d=e.item.polaczone;1!=d&&0!=d&&(d=t("filter")(e.projekt.zadania,{idZadania:d},!0),window.console&&console.log("polaczone: "+d[0].nazwa),"none"==d[0].ukonczoneDisplay&&(e.item.candone=!1)),window.console&&console.log(e.item.candone),e.baza=i.items,e.currentuser=s.items;var c=e.item.lokalizacja;c&&(c=c.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),e.someSafeContent=r.trustAsHtml(c);var l=t("filter")(e.projekt.zadania,{data:e.item.data},!0);l.length>0&&(e.milestoneName=l[0]);var p;e.startTimer=function(i,n,s){s=e.currentuser.idUser;var r,d,c,u;r=t("filter")(a.items,{idProjekt:n},!0),d=t("filter")(r[0].zadania,{idZadania:i},!0);d[0].nazwa;console.log(e.item),$("#clockTaskName").text(e.item.nazwa),c=t("filter")(e.item.przypisaneOsoby,{idUser:s},!0),u=t("filter")(r[0].przypisaneOsoby,{idUser:s},!0);var m=c[0].stawka,y=c[0].czasUzytkownika,z=c[0].kasaUzytkownika;$("#timer").css("display","block");var f=y,k=(f-f%60)/60,g=(f/60*m/100).toFixed(2),w=Math.floor(f/60*m),v=document.getElementById("clockdiv");$(".clockAnimation").addClass("animateClock"),10>f-60*k?v.innerHTML=k+":0"+(f-60*k)+" | "+g+"zł":v.innerHTML=k+":"+(f-60*k)+" | "+g+"zł",p=setInterval(function(){f++,g=(f/60*m/100).toFixed(2),w=Math.floor(f/60*m),k=(f-f%60)/60,10>f-60*k?v.innerHTML=k+":0"+(f-60*k)+" | "+g+"zł":v.innerHTML=k+":"+(f-60*k)+" | "+g+"zł",c[0].czasUzytkownika=f,c[0].kasaUzytkownika=w},6e4),$(".stopTimer").one("click",function(){if(clearInterval(p),$(".clockAnimation").removeClass("animateClock"),$("#timer").fadeOut(),d[0].budzetGodzinowyWykorzystanie+=f-y,d[0].budzetPienieznyWykorzystanie+=w-z,u[0].czasUzytkownika+=f-y,u[0].kasaUzytkownika+=w-z,$.ajax({type:"POST",url:o,data:{idZadania:i,idProjekt:n,idUser:s,czasZadanie:c[0].czasUzytkownika,kasaZadanie:c[0].kasaUzytkownika,czasProjekt:u[0].czasUzytkownika,kasaProjekt:u[0].kasaUzytkownika,updateTime:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){window.console&&console.log(e)}}),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply(),$("#taskCharts .chartHours"),$("#taskCharts .chartHours").find("canvas").length){var a=$("#taskCharts .chartHours").attr("data-percent");$("#taskCharts .chartHours").data("easyPieChart").update(a),a=$("#taskCharts .chartMoney").attr("data-percent"),$("#taskCharts .chartMoney").data("easyPieChart").update(a)}e.$root.$broadcast("updateTerms")})},e.markAsComplete=function(a,t){function l(e,a,t,i){var o=6371,n=p(t-e),s=p(i-a),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(p(e))*Math.cos(p(t))*Math.sin(s/2)*Math.sin(s/2),d=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),c=o*d;return c}function p(e){return e*(Math.PI/180)}var i,n,s,c=function(a){i=a.coords.latitude,n=a.coords.longitude,s=s.replace("(",""),s=s.replace(")",""),s=s.split(",");var r=s[0],d=s[1],c=l(i,n,r,d);if(.3>c){var p=new Date,m=p.getDate(),y=p.getMonth()+1,z=p.getFullYear(),f=p.getHours(),k=p.getMinutes();u(m,y,z,f,k,0);10>m&&(m="0"+m),10>y&&(y="0"+y),10>f&&(f="0"+f),10>k&&(k="0"+k),p=m+"."+y+"."+z+" "+f+":"+k;var w=e.addLogElement(t,e.user.idUser,"koniecZadania","",e.user.imienazwisko,e.user.avatar,p,0),v={idLog:w,typ:"koniecZadania",data:p,dataPrezentacja:"Dziś - "+f+":"+k,odczytane:0};e.projekt.log.push(v),e.item.ukonczoneDisplay="block",e.item.priorytet="prioFinished",$.ajax({type:"POST",url:o,data:{idZadania:e.item.idZadania,finishTask:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(){}}),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply(),e.$root.$broadcast("updateTerms")}else ons.notification.alert({message:"Musisz być w odpowiedniej lokalizacji, by zakonczyć to zadanie",title:"Za daleko",buttonLabel:"OK",animation:"default",callback:function(){}})};if(""!=e.item.latLngPosition&&e.item.latLngPosition){alert("sprawdzanie poprawności lokalizacji");var h={};s=e.item.latLngPosition,navigator.geolocation.getCurrentPosition(c,null,h)}else{e.item.ukonczoneDisplay="block",e.item.priorytet="prioFinished","$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply();var m=new Date,y=m.getDate(),z=m.getMonth()+1,f=m.getFullYear(),k=m.getHours(),g=m.getMinutes();u(y,z,f,k,g,0);10>y&&(y="0"+y),10>z&&(z="0"+z),10>k&&(k="0"+k),10>g&&(g="0"+g),m=y+"."+z+"."+f+" "+k+":"+g;var v=e.addLogElement(t,e.user.idUser,"koniecZadania","",e.user.imienazwisko,e.user.avatar,m,0),b={idLog:v,typ:"koniecZadania",data:m,dataPrezentacja:"Dziś - "+k+":"+g,odczytane:0};e.projekt.log.push(b),$.ajax({type:"POST",url:o,data:{idZadania:e.item.idZadania,finishTask:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(){}}),e.$root.$broadcast("updateTerms")}},e.isUserIn=function(a,t,i){var o=!1;return angular.forEach(e.item.przypisaneOsoby,function(e,a){e.idUser==i&&(o=!0)}),o},e.closeSingleTask=function(){navi.popPage(),e.$root.$broadcast("updateTerms"),$("#commentForm").css("display","none")},e.shortname=String(e.item.nazwa).substring(0,15)+"...",e.addComment=function(){var a=$("#newComment").val(),t=new Date,i=t.getDate(),n=t.getMonth()+1,s=t.getFullYear(),r=t.getHours(),d=t.getMinutes();10>i&&(i="0"+i),10>n&&(n="0"+n),10>r&&(r="0"+r),10>d&&(d="0"+d),t=u(i,n,s,r,d,9);var c=i+"."+n+"."+s+" "+r+":"+d;({idZadania:e.item.idZadania,admin:1,type:"normal",text:a,data:c,avatar:e.currentuser[0].avatar,autor:e.currentuser[0].imie});$.ajax({type:"POST",url:o,data:{idZadania:e.item.idZadania,admin:1,type:"normal",text:a,data:c,avatar:e.currentuser[0].avatar,autor:e.currentuser[0].imie,addComment:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){$.ajax({type:"POST",url:o,data:{idZadania:e.item.idZadania,getTaskComments:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){e.item.komentarze?e.item.komentarze=angular.fromJson(a).komentarze:(e.item.komentarze=[],e.item.komentarze=angular.fromJson(a).komentarze),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}})}}),$("#newComment").val("")},e.$on("addCommentEvent",function(a){e.addComment()}),e.goToKomentarze=function(){$("#informacjeTab").css("display","none"),$("#komentarzeTab").css("display","block"),$("#commentForm").css("display","block"),$.ajax({type:"POST",url:o,data:{idZadania:e.item.idZadania,getTaskComments:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){e.item.komentarze?e.item.komentarze=angular.fromJson(a).komentarze:(e.item.komentarze=[],e.item.komentarze=angular.fromJson(a).komentarze),
"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}}),n=setInterval(function(){$.ajax({type:"POST",url:o,data:{idZadania:e.item.idZadania,getTaskComments:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){e.item.komentarze?e.item.komentarze=angular.fromJson(a).komentarze:(e.item.komentarze=[],e.item.komentarze=angular.fromJson(a).komentarze),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}})},5e3)},e.goToInformacje=function(){$("#informacjeTab").css("display","block"),$("#komentarzeTab").css("display","none"),$("#commentForm").css("display","none")},e.addUserToTask=function(a,i){var n=t("filter")(e.projekt.przypisaneOsoby,{idUser:a},!0),s=t("filter")(e.projekt.zadania,{idZadania:i},!0),r={idZadania:s[0].idZadania,idUser:n[0].idUser,imie:n[0].imie,avatar:n[0].avatar,stawka:n[0].stawka,punktyUzytkownika:s[0].punktyPremioweWartosc,kasaUzytkownika:0,czasUzytkownika:0};s[0].przypisaneOsoby?s[0].przypisaneOsoby.push(r):(s[0].przypisaneOsoby=[],s[0].przypisaneOsoby.push(r)),s[0].avatarPierwszejOsoby=n[0].avatar,s[0].brakOsobyDisplay="none",e.$root.$broadcast("updateTerms"),$.ajax({type:"POST",url:o,data:{idZadania:s[0].idZadania,idUser:n[0].idUser,imie:n[0].imie,avatar:n[0].avatar,stawka:n[0].stawka,punktyUzytkownika:s[0].punktyPremioweWartosc,addUserToTask:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}})}}),e.controller("ZasobController",function(e,a,t,i,n){e.item=a.selectedZasob,e.currentuser=n.items,e.currentuser=e.currentuser[0],e.reserveZasobNow=function(a){var t=$("#rezerwacjaOd input").val(),i=$("#rezerwacjaDo input").val();if(""==t||""==i)ons.notification.alert({message:"Podaj wszystkie dane",title:"Brak daty",buttonLabel:"OK",animation:"default",callback:function(){}});else{var n=t.substring(8,10),s=t.substring(5,7),r=t.substring(0,4),d=t.substring(11,13),c=t.substring(14,16),l=n+"."+s+"."+r+" "+d+":"+c,p=u(n,s,r,d,c,0),m=i.substring(8,10),y=i.substring(5,7),z=i.substring(0,4),f=i.substring(11,13),k=i.substring(14,16),g=m+"."+y+"."+z+" "+f+":"+k,w=u(m,y,z,f,k,0);if("01"==s&&(s="STY"),"02"==s&&(s="LUT"),"03"==s&&(s="MAR"),"04"==s&&(s="KWI"),"05"==s&&(s="MAJ"),"06"==s&&(s="CZE"),"07"==s&&(s="LIP"),"08"==s&&(s="SIE"),"09"==s&&(s="WRZ"),"10"==s&&(s="PAZ"),"11"==s&&(s="LIS"),"12"==s&&(s="GRU"),p>=w)ons.notification.alert({message:"Data końcowa nie może być mniejsza niż data początku",title:"Niepoprawne daty",buttonLabel:"OK",animation:"default",callback:function(){}});else if(e.item.rezerwacje){var v=!1;angular.forEach(e.item.rezerwacje,function(e,a){alert(e.idRezerwacji),p>=e.odOrder&&p<=e.doOrder&&(v=!0),w>=e.odOrder&&w<=e.doOrder&&(v=!0),e.odOrder>=p&&e.doOrder<=w&&(v=!0)}),v?ons.notification.alert({message:"Okres rezerwacji nie może pokrywać się z inną rezerwacją",title:"Niepoprawne daty",buttonLabel:"OK",animation:"default",callback:function(){}}):$.ajax({type:"POST",url:o,data:{idZasob:e.item.idZasob,imie:e.currentuser.imie,avatar:e.currentuser.avatar,dzien:n,miesiac:s,dataOd:l,dataDo:g,odOrder:p,doOrder:w,submitReservationToBase:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){var t={idRezerwacji:a,idZasob:e.item.idZasob,imie:e.currentuser.imie,avatar:e.currentuser.avatar,dzien:n,miesiac:s,dataOd:l,dataDo:g,odOrder:p,doOrder:w};e.item.rezerwacje?(e.item.rezerwacje.push(t),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()):(e.item.rezerwacje=[],e.item.rezerwacje.push(t),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()),navi.popPage()}})}else alert("dodaje"),$.ajax({type:"POST",url:o,data:{idZasob:e.item.idZasob,imie:e.currentuser.imie,avatar:e.currentuser.avatar,dzien:n,miesiac:s,dataOd:l,dataDo:g,odOrder:p,doOrder:w,submitReservationToBase:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){var t={idRezerwacji:a,idZasob:e.item.idZasob,imie:e.currentuser.imie,avatar:e.currentuser.avatar,dzien:n,miesiac:s,dataOd:l,dataDo:g,odOrder:p,doOrder:w};e.item.rezerwacje?(e.item.rezerwacje.push(t),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()):(e.item.rezerwacje=[],e.item.rezerwacje.push(t),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()),navi.popPage()}})}}}),e.controller("DetailController",function(e,t,n,r,d){e.item=t.selectedItem,e.baza=r.items,e.rezerwacja="";e.currentuser=d.items;var l=0;e.item.krotkitytul=e.item.tytul.substring(0,15)+"...",e.$on("updateTerms",function(a){e.RebuildTerms()}),e.acceptNotification=function(a){var t=n("filter")(e.item.koszty,{idKoszt:a},!0);$('.notificationBox[data-koszt="'+a+'"]').fadeOut("fast",function(){t[0].zaakceptowanyUser=1}),$.ajax({type:"POST",url:o,data:{idKoszt:a,acceptNotification:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}})},e.$on("addUserToTaskEvent",function(a,t){alert(t.userid),alert(t.taskid),e.addUserToTaskGlobalF(t.userid,t.taskid)}),e.addUserToTaskGlobalF=function(a,t){var i=n("filter")(e.item.przypisaneOsoby,{idUser:a},!0),s=n("filter")(e.item.zadania,{idZadania:t},!0),r={idZadania:s[0].idZadania,idUser:i[0].idUser,imie:i[0].imie,avatar:i[0].avatar,stawka:i[0].stawka,punktyUzytkownika:s[0].punktyPremioweWartosc,kasaUzytkownika:0,czasUzytkownika:0};s[0].przypisaneOsoby?s[0].przypisaneOsoby.push(r):(s[0].przypisaneOsoby=[],s[0].przypisaneOsoby.push(r)),s[0].avatarPierwszejOsoby=i[0].avatar,s[0].brakOsobyDisplay="none",e.$root.$broadcast("updateTerms"),$.ajax({type:"POST",url:o,data:{idZadania:s[0].idZadania,idUser:i[0].idUser,imie:i[0].imie,avatar:i[0].avatar,stawka:i[0].stawka,punktyUzytkownika:s[0].punktyPremioweWartosc,addUserToTask:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}})},e.acceptCost=function(a){var t=n("filter")(e.item.koszty,{idKoszt:a},!0);ons.notification.confirm({title:"Akceptacja kosztu",message:"Czy chcesz zaakceptować koszt?",buttonLabels:["Tak","Nie","Anuluj"],primaryButtonIndex:0,callback:function(e){0==e&&($('.notificationBox[data-koszt="'+a+'"]').fadeOut("fast",function(){t[0].zaakceptowanyAdmin=1}),$.ajax({type:"POST",url:o,data:{idKoszt:a,zaakceptowanyAdmin:1,answereNotification:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}})),1==e&&($('.notificationBox[data-koszt="'+a+'"]').fadeOut("fast",function(){t[0].zaakceptowanyAdmin=2}),$.ajax({type:"POST",url:o,data:{idKoszt:a,zaakceptowanyAdmin:2,answereNotification:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}}))}})},e.submitCost=function(){var a=e.item.idProjekt,t=$("#itemCost").val(),i=$("#nazwaKosztu").val(),n=e.currentuser[0].idUser,s=e.currentuser[0].imie,r=e.currentuser[0].avatar;""==i?ons.notification.alert({message:"Podaj nazwę kosztu",title:"Brak nazwy",buttonLabel:"OK",animation:"default",callback:function(){}}):$.ajax({type:"POST",url:o,data:{idProjekt:a,idUser:n,imie:s,avatar:r,kwota:t,nazwa:i,submitCostToBase:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(o){var d={idKoszt:o,idProjekt:a,idUser:n,imie:s,avatar:r,kwota:t,nazwa:i};e.item.koszty?e.item.koszty.push(d):(e.item.koszty=[],e.item.koszty.push(d)),navi.popPage()}})},e.showTask=function(a){var i=n("filter")(e.item.zadania,{idZadania:a},!0),o=i[0];t.selectedTask=o,e.navi.pushPage("singleTask.html",{title:o.nazwa})},e.addNewTask=function(){var a=$("#nazwaZadania").val(),t=$("#wybranyPolaczony select").val(),i=$("#wybranyTermin select").val(),r=0;if("inny"==i&&(i=$("#innaData input").val(),r=1),""==a)ons.notification.alert({message:"Podaj nazwę zadania",title:"Brak nazwy",buttonLabel:"OK",animation:"default",callback:function(){}});else if(""==i)ons.notification.alert({message:"Podaj termin wykonania zadania",title:"Brak daty",buttonLabel:"OK",animation:"default",callback:function(){}});else{var d=$("#opisZadania").val(),c="none",l=$("#lokalizacjaZadania").html(),p=$("#lokalizacjaZadaniaLatLng").html();"Wybierz lokalizację"!=l&&l&&(c="block");var m=$("#wybranyPriorytet select").val(),y=0;"niski"==m&&(m="prioLow",y=3),"normalny"==m&&(m="prioNormal",y=2),"wysoki"==m&&(m="prioImportant",y=1);var z,f,k,g,w,v;if(0==r){i=parseInt(i);var b=n("filter")(e.item.terminy,{idTerminu:i},!0);z=b[0].orderKey-9+y,i=b[0].data;var h=i;f=i.substring(0,2),k=i.substring(3,5),g=i.substring(6,10),w=i.substring(11,13),v=i.substring(14,16)}else{f=i.substring(8,10),k=i.substring(5,7),g=i.substring(0,4),w=i.substring(11,13),v=i.substring(14,16),i=f+"."+k+"."+g+" "+w+":"+v;var h=i;z=u(f,k,g,w,v,y)}"01"==k&&(k="STY"),"02"==k&&(k="LUT"),"03"==k&&(k="MAR"),"04"==k&&(k="KWI"),"05"==k&&(k="MAJ"),"06"==k&&(k="CZE"),"07"==k&&(k="LIP"),"08"==k&&(k="SIE"),"09"==k&&(k="WRZ"),"10"==k&&(k="PAZ"),"11"==k&&(k="LIS"),"12"==k&&(k="GRU");var j=0,P="nie";1==$("#zadanieCzyPieniadze input:checked").length&&(P="tak",j=$("#zadanieWartoscBudzetGodziny select").val());var _=0,T="nie";1==$("#zadanieCzyGodziny input:checked").length&&(T="tak",_=$("#zadanieWartoscBudzetPieniadze select").val());var U=0,O="nie";1==$("#czyPunktyPremiowe input:checked").length&&(O="tak",U=$("#zadanieWartoscPunktyPremiowe select").val());var D="data:image/png;base64,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",A=0;e.currentuser[0].tmp&&(A=e.currentuser[0].tmp.length);var C="block",S="none";A>0&&(C="none",D=e.currentuser[0].tmp[0].avatar),A>1&&(S="inline-block");var Z=e.item.idProjekt;$.ajax({type:"POST",url:o,data:{idProjekt:Z,idTerminu:"",nazwa:a,opis:d,data:i,dataDzien:f,dataMiesiac:k,dataGodzina:w+":"+v,orderKey:z,basicItem:"block",milestone:"none",mileStoneNaglowek:"",milestoneUkonczoneZadaniaProcent:0,milestoneWykorzystanyBudzetPieniadze:0,milestoneWykorzystanyBudzetGodziny:0,avatarPierwszejOsoby:D,dodatkoweOsobyDisplay:S,dotatkoweOsoby:A-1,ukonczoneDisplay:"none",brakOsobyDisplay:C,lokalizacjaDisplay:c,lokalizacja:l,latLngPosition:p,priorytet:m,status:"oczekuje",budzetPieniezny:T,budzetPienieznyWartosc:_,budzetPienieznyWykorzystanie:0,budzetGodzinowy:P,budzetGodzinowyWartosc:j,budzetGodzinowyWykorzystanie:0,punktyPremiowe:O,punktyPremioweWartosc:U,polaczone:t,addTaskToProject:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(i){var n=parseInt(i);s=n,e.uploadFile();var r={idZadania:parseInt(i),orderKey:z,basicItem:"block",data:h,dataDzien:f,dataMiesiac:k,dataGodzina:w+":"+v,notyfikacjeDisplay:"none",notyfikacje:0,lokalizacjaDisplay:c,lokalizacja:l,latLngPosition:p,brakOsobyDisplay:C,ukonczoneDisplay:"none",avatarPierwszejOsoby:D,dotatkoweOsoby:A-1,dodatkoweOsobyDisplay:S,nazwa:a,opis:d,priorytet:m,statusUzytkownika:"oczekuje",statusClass:"completionHalf",czasUzytkownika:"00:00",kasaUzytkownika:0,punktyUzytkownika:0,budzetPieniezny:T,budzetPienieznyWartosc:_,budzetPienieznyWykorzystanie:0,budzetGodzinowy:P,budzetGodzinowyWartosc:j,budzetGodzinowyWykorzystanie:0,punktyPremiowe:O,punktyPremioweWartosc:U,polaczone:t,przypisaneOsoby:angular.copy(e.currentuser[0].tmp),komentarze:[]};angular.forEach(e.currentuser[0].tmp,function(e,a){$.ajax({type:"POST",url:o,data:{idZadania:n,idUser:e.idUser,imie:e.imie,avatar:e.avatar,stawka:e.stawka,punktyUzytkownika:U,addUserToTask:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}})}),e.item.zadania||(e.item.zadania=[]),e.item.zadania.push(r),e.$apply(),e.currentuser[0].tmp&&e.currentuser[0].tmp.splice(0,A);var y=new Date;f=y.getDate(),k=y.getMonth()+1,g=y.getFullYear(),w=y.getHours(),v=y.getMinutes(),10>f&&(f="0"+f),10>k&&(k="0"+k),10>w&&(w="0"+w),10>v&&(v="0"+v),y=u(f,k,g,w,v,9);var b=f+"."+k+"."+g+" "+w+":"+v,Z=e.addLogElement(e.item.idProjekt,e.currentuser[0].idUser,"noweZadanie",a,e.currentuser[0].imienazwisko,e.currentuser[0].avatar,b,0),B={idLog:Z,idZadania:n,orderKey:y,typ:"noweZadanie",nazwa:a,osoba:e.currentuser[0].imie+" "+e.currentuser[0].nazwisko,idOsoby:e.currentuser[0].idUser,avatarOsoby:e.currentuser[0].avatar,data:f+"."+k+"."+g+" "+w+":"+v,dataPrezentacja:"Dziś - "+w+":"+v,odczytane:0};e.item.log.push(B),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply(),e.RebuildTerms(),navi.popPage()}})}},e.RebuildTerms=function(){var a=localStorage.email;e.getUserData(a,0);var t=[],i=e.currentuser[0].idUser;angular.forEach(e.item.zadania,function(e,a){e.budzetPienieznyWykorzystanie=0,e.budzetGodzinowyWykorzystanie=0,e.statusUzytkownika="oczekuje",e.statusClass="completionHalf",angular.forEach(e.przypisaneOsoby,function(a,t){e.osobaKasa=a.kasaUzytkownika,e.osobaCzasTF=0,e.osobaKasaTF=0,a.idUser==i&&(e.osobaCzas=a.czasUzytkownika,e.osobaKasa=a.kasaUzytkownika,e.osobaCzasTF=1,e.osobaKasaTF=1),e.budzetPienieznyWykorzystanie+=a.kasaUzytkownika,e.budzetGodzinowyWykorzystanie+=a.czasUzytkownika,0==e.budzetGodzinowyWykorzystanie?(e.statusUzytkownika="oczekuje",e.statusClass="completionHalf"):(e.statusUzytkownika="w trakcie",e.statusClass="completionHalf")})}),angular.forEach(e.item.terminy,function(a,i){var o=n("filter")(e.item.zadania,{idTerminu:a.idTerminu},!0),s=o[0].orderKey;t[i]=s}),t.sort();var s=0;t.forEach(function(a){var i=n("filter")(e.item.zadania,{orderKey:a},!0),o=i[0].orderKey;i[0].mileStoneNaglowek="Milestone "+(s+1),i[0].milestoneUkonczoneZadaniaProcent=0,i[0].milestoneWykorzystanyBudzetPieniadze=0,i[0].milestoneWykorzystanyBudzetGodziny=0;var r=0,d=0,c=0,u=0,l=0,p=0;angular.forEach(e.item.zadania,function(e,a){0==s?e.orderKey<=o&&e.orderKey>0&&(e.idTerminu||(r++,"prioFinished"==e.priorytet&&d++,"tak"==e.budzetPieniezny&&(c+=e.budzetPienieznyWartosc,u+=e.budzetPienieznyWykorzystanie),"tak"==e.budzetGodzinowy&&(l+=e.budzetGodzinowyWartosc,p+=e.budzetGodzinowyWykorzystanie))):e.orderKey<=o&&e.orderKey>t[s-1]&&(e.idTerminu||(r++,"prioFinished"==e.priorytet&&d++,"tak"==e.budzetPieniezny&&(c+=e.budzetPienieznyWartosc,u+=e.budzetPienieznyWykorzystanie),"tak"==e.budzetGodzinowy&&(l+=e.budzetGodzinowyWartosc,p+=e.budzetGodzinowyWykorzystanie)))}),r>0&&(i[0].milestoneUkonczoneZadaniaProcent=d/r*100),c>0&&(i[0].milestoneWykorzystanyBudzetPieniadze=u/c*100),l>0&&(i[0].milestoneWykorzystanyBudzetGodziny=p/l*100),s++}),s=0;var r=0,d=0,c=0,l=0,p=0,m=0,y=0;e.item.budzetPienieznyWykorzystanie=0,e.item.budzetGodzinowyWykorzystanie=0,e.item.ukonczoneZadania=0,e.item.wszystkieZadania=0,e.item.zadaniaPrzypisaneDoUzytkownika=0,e.item.zadaniaNieprzypisane=0,e.item.zadaniaPoTerminie=0,e.item.zadaniaPrzekroczonyBudzet=0;var z=new Date,f=z.getDate(),k=z.getMonth()+1,g=z.getFullYear(),w=z.getHours(),v=z.getMinutes();10>f&&(f="0"+f),10>k&&(k="0"+k),10>w&&(w="0"+w),10>v&&(v="0"+v),z=u(f,k,g,w,v,9),angular.forEach(e.item.zadania,function(e,a){e.idTerminu||(r++,"prioFinished"==e.priorytet&&d++,e.przypisaneOsoby&&0==e.przypisaneOsoby.length&&c++,e.przypisaneOsoby||c++,e.orderKey<z&&"prioFinished"!=e.priorytet&&l++,(e.budzetPienieznyWartosc<e.budzetPienieznyWykorzystanie||e.budzetGodzinowyWartosc<e.budzetGodzinowyWykorzystanie)&&p++,m+=e.budzetPienieznyWykorzystanie,y+=e.budzetGodzinowyWykorzystanie)}),angular.forEach(e.item.koszty,function(e,a){1==e.zaakceptowanyAdmin&&(m+=e.kwota)}),e.item.budzetPienieznyWykorzystanie=m,e.item.budzetGodzinowyWykorzystanie=y,e.item.ukonczoneZadania=d,e.item.wszystkieZadania=r;var b=Math.floor(d/r*100);e.item.procentUkonczeniaProjektu=b,$.ajax({type:"POST",url:o,data:{idProjekt:e.item.idProjekt,procentUkonczeniaProjektu:e.item.procentUkonczeniaProjektu,updateProjectCompletion:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}}),e.item.zadaniaPrzypisaneDoUzytkownika=0,e.item.zadaniaNieprzypisane=c,e.item.zadaniaPoTerminie=l,e.item.zadaniaPrzekroczonyBudzet=p,"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()},e.dodajZasob=function(){navi.pushPage("addZasob.html",{animation:"slide"})},e.reserveZasob=function(a){var i=n("filter")(e.item.zasoby,{idZasob:a},!0);t.selectedZasob=i[0],navi.pushPage("reserveZasob.html",{animation:"slide"})},e.addZasob=function(){var a=e.item.idProjekt,t=$("#opisZasob").val(),i=$("#nazwaZasob").val();e.currentuser[0].idUser,e.currentuser[0].imie,e.currentuser[0].avatar;""==i?ons.notification.alert({message:"Podaj nazwę zasobu",title:"Brak nazwy",buttonLabel:"OK",animation:"default",callback:function(){}}):$.ajax({type:"POST",url:o,data:{idProjekt:a,nazwa:i,opis:t,submitZasobToBase:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(o){var n={idZasob:o,idProjekt:a,nazwa:i,opis:t};e.item.zasoby?(e.item.zasoby.push(n),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()):(e.item.zasoby=[],e.item.zasoby.push(n),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()),navi.popPage()}})},e.projectOptions=function(){ons.notification.confirm({title:"Opcje projektu",message:"co chcesz zrobić?",buttonLabels:["Dodaj zadanie","Zarządzaj osobami","Zarządzaj terminami","Zarządzaj budżetem","Dodaj zasób","Zakończ projekt","Anuluj"],primaryButtonIndex:0,callback:function(a){if(0==a&&navi.pushPage("newtask.html",{animation:"slide"}),1==a&&navi.pushPage("editPeople.html",{animation:"slide"}),2==a&&navi.pushPage("editTerms.html",{animation:"slide"}),3==a&&navi.pushPage("editBudget.html",{animation:"slide"}),4==a&&navi.pushPage("addZasob.html",{animation:"slide"}),5==a){e.item.zamkniety="tak";var t=new Date,i=t.getDate(),o=t.getMonth()+1,n=t.getFullYear(),s=t.getHours(),r=t.getMinutes();10>i&&(i="0"+i),10>o&&(o="0"+o),10>s&&(s="0"+s),10>r&&(r="0"+r),t=i+"."+o+"."+n+" "+s+":"+r;var d=e.addLogElement(e.item.idProjekt,e.currentuser[0].idUser,"zakonczenieProjektu","",e.currentuser[0].imienazwisko,e.currentuser[0].avatar,t,0),c={idLog:d,typ:"zakonczenieProjektu",data:t,dataPrezentacja:"Dziś - "+s+":"+r,odczytane:0};e.item.log.push(c),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}}})},e.projectOptionsUser=function(){e.isAndroidTest()?ons.notification.confirm({title:"Opcje projektu",message:"co chcesz zrobić?",buttonLabels:[e.lang.report_cost,"Przyjmij zadanie przez NFC","Anuluj"],primaryButtonIndex:0,callback:function(a){0==a&&navi.pushPage("addCost.html",{animation:"slide"}),1==a&&e.lisenNFC()}}):ons.notification.confirm({title:"Opcje projektu",message:"co chcesz zrobić?",buttonLabels:[e.lang.report_cost,"Anuluj"],primaryButtonIndex:0,callback:function(e){0==e&&navi.pushPage("addCost.html",{animation:"slide"})}})},e.applyLocation=function(){var e=$("#adressPreview").html();if("Kliknij na mapie, by wybrać lokalizację"!=e){$("#lokalizacjaZadania").html(e);var a=$("#adressPreview small").html();$("#lokalizacjaZadaniaLatLng").html(a)}navi.popPage()},e.initMap=function(){function d(){this.initialize=function(){t=i(),navigator.geolocation.getCurrentPosition(o,null,n)};var i=function(){var t={zoom:12,disableDefaultUI:!0,center:new google.maps.LatLng(e,a),mapTypeId:google.maps.MapTypeId.ROADMAP},i=new google.maps.Map(document.getElementById("map_canvas"),t);i.addListener("click",function(e){c(e.latLng,i)}),r=new google.maps.Geocoder;var o=document.getElementById("pac-input"),n=new google.maps.places.SearchBox(o);i.controls[google.maps.ControlPosition.TOP_LEFT].push(o),i.addListener("bounds_changed",function(){n.setBounds(i.getBounds())});return n.addListener("places_changed",function(){var e=n.getPlaces();if(0!=e.length){var a=new google.maps.LatLngBounds;e.forEach(function(e){({url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)});e.geometry.viewport?a.union(e.geometry.viewport):a.extend(e.geometry.location)}),i.fitBounds(a),i.setZoom(12)}}),i}}function c(e,a){null!=s&&s.setMap(null),s=new google.maps.Marker({position:e,map:a}),l(e),a.panTo(e)}function u(e,a,t){t.setCenter(new google.maps.LatLng(e,a))}function l(e){r.geocode({latLng:e},function(a,t){if(t==google.maps.GeocoderStatus.OK)if(a[0]){var o=a[0].address_components.length,n="",s="",r="",d="";for(i=0;i<o;i++)"street_number"==a[0].address_components[i].types[0]&&(s=a[0].address_components[i].short_name),"route"==a[0].address_components[i].types[0]&&(n=a[0].address_components[i].short_name),"locality"==a[0].address_components[i].types[0]&&(r=a[0].address_components[i].short_name),"postal_code"==a[0].address_components[i].types[0]&&(d=a[0].address_components[i].short_name);""!=n&&""!=d?$("#adressPreview").html(n+" "+s+"<br/>"+d+" "+r+"<br/><small>"+e+"</small>"):""!=n?$("#adressPreview").html(n+" "+s+"<br/><small>"+e+"</small>"):""!=d&&$("#adressPreview").html(d+" "+r+"<br/><small>"+e+"</small>")}else $("#adressPreview").html("Nie znaleziono adresu");else $("#adressPreview").html(t)})}var t,r,e=0,a=0,o=function(i){e=i.coords.latitude,a=i.coords.longitude,u(e,a,t)},n={},s=null,t=new d;t.initialize()},e.goToAddNewPersonTab=function(){$("#currentProjectPeopleTab").css("display","none"),$("#addNewPersonTab").css("display","block")},e.goToPersonListTab=function(){$("#currentProjectPeopleTab").css("display","block"),$("#addNewPersonTab").css("display","none")},e.addPersonNew=function(a){var t=n("filter")(e.item.przypisaneOsoby,{idUser:a},!0);t.length>0?ons.notification.alert({message:"Ta osoba jest już dodana do tego projektu"}):ons.notification.prompt({message:"Wpisz stawkę godzinową",callback:function(t){var i=n("filter")(e.baza,{idUser:a},!0),s={idUser:i[0].idUser,imie:i[0].imienazwisko,email:i[0].email,avatar:i[0].avatar,stawka:100*t,iloscZadan:0,czasUzytkownika:0,kasaUzytkownika:0,punktyUzytkownika:0};if($.ajax({type:"POST",url:o,data:{idProjekt:e.item.idProjekt,idUser:i[0].idUser,imie:i[0].imienazwisko,avatar:i[0].avatar,stawka:100*t,punktyUzytkownika:0,addUserToProject:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}}),e.item.przypisaneOsoby.push(s),e.currentuser[0].ostatnieOsoby){var r=n("filter")(e.currentuser[0].ostatnieOsoby,{idUser:a},!0);r.length>0||e.currentuser[0].ostatnieOsoby.push(s)}else e.currentuser[0].ostatnieOsoby=[],e.currentuser[0].ostatnieOsoby.push(s);"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}})},e.userAdded=function(a){var t=n("filter")(e.item.przypisaneOsoby,{idUser:a},!0);return t.length>0?!0:!1},e.userNoTask=function(a){var t=n("filter")(e.item.zadania.przypisaneOsoby,{idUser:a},!0);return t?!1:!0},e.removePerson=function(a){var t=n("filter")(e.item.przypisaneOsoby,{idUser:a},!0),i=e.item.przypisaneOsoby.indexOf(t[0]);e.item.przypisaneOsoby.splice(i,1)},e.addPersonLast=function(a){var t=n("filter")(e.item.przypisaneOsoby,{idUser:a},!0);if(t.length>0)ons.notification.alert({message:"Ta osoba jest już dodana do tego projektu"});else{var i=n("filter")(e.currentuser[0].ostatnieOsoby,{idUser:a},!0),o={idUser:i[0].idUser,imie:i[0].imie,email:i[0].email,avatar:i[0].avatar,stawka:i[0].stawka,iloscZadan:0,czasUzytkownika:"00:00",kasaUzytkownika:"0",punktyUzytkownika:0};e.item.przypisaneOsoby.push(o)}},e.addTermTemplate=function(){var e=$('<li class="list__item pojedynczyTerminNowy" style="padding-right:8px; display:none;"><ons-row align="center" class="row ons-row-inner row-center" style="padding-right:1px;"><ons-col class="col ons-col-inner">Data*</ons-col><ons-col class="col ons-col-inner" style="padding-right:8px;"><input type="datetime-local"  class="inputClear" value="'+(new Date).toJSON().slice(0,19)+'" ></ons-col></ons-row><ons-row align="center" class="row ons-row-inner row-center"><ons-col class="col ons-col-inner">Nazwa*</ons-col><ons-col class="col ons-col-inner"><input type="text" class="text-input text-input--transparent inputWithLabel" placeholder="Nazwa terminu"></ons-col></ons-row></li>');$("#terminyNowe").append(e),$(e).fadeIn(2e3)},e.updateBudget=function(){"tak"==e.item.budzetGodzinowy&&(e.item.budzetGodzinowyWartosc=60*parseInt($("#newHourBudgetText").text())),"tak"==e.item.budzetPieniezny&&(e.item.budzetPienieznyWartosc=100*parseInt($("#newMoneyBudgetText").text())),$.ajax({type:"POST",url:o,data:{idProjekt:e.item.idProjekt,budzetGodzinowyWartosc:60*parseInt($("#newHourBudgetText").text()),budzetPienieznyWartosc:100*parseInt($("#newMoneyBudgetText").text()),updateBudget:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}}),navi.popPage()},e.updateTerms=function(){$(".pojedynczyTerminNowy").each(function(a){var t=e.item.idProjekt,i=0;e.item.terminy&&(i=e.item.terminy.length);var n=$(this).find('input[type="datetime-local"]').val(),s=n.substring(8,10),r=n.substring(5,7),d=n.substring(0,4),c=n.substring(11,13),l=n.substring(14,16);n=s+"."+r+"."+d+" "+c+":"+l;var p=u(s,r,d,c,l,9),m=$(this).find('input[type="text"]').val();$.ajax({type:"POST",url:o,data:{idProjekt:t,orderKey:p,mileStoneNaglowek:"Milestone "+(i+a+1),data:n,nazwa:m,addNewTerm:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(d){var u=d;$.ajax({type:"POST",url:o,data:{idProjekt:t,idTerminu:u,nazwa:m,opis:"",data:n,dataDzien:s,dataMiesiac:r,dataGodzina:c+":"+l,orderKey:p,basicItem:"none",milestone:"block",mileStoneNaglowek:"Milestone "+(i+a+1),milestoneUkonczoneZadaniaProcent:0,milestoneWykorzystanyBudzetPieniadze:0,milestoneWykorzystanyBudzetGodziny:0,avatarPierwszejOsoby:"",dodatkoweOsobyDisplay:"none",dotatkoweOsoby:0,ukonczoneDisplay:"none",brakOsobyDisplay:"none",lokalizacjaDisplay:"none",lokalizacja:"none",latLngPosition:"none",priorytet:"none",status:"none",budzetPieniezny:"none",budzetPienieznyWartosc:0,budzetPienieznyWykorzystanie:0,budzetGodzinowy:"none",budzetGodzinowyWartosc:0,budzetGodzinowyWykorzystanie:0,
punktyPremiowe:"none",punktyPremioweWartosc:0,addTaskToProject:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(t){var o=t,s={idZadania:o,idTerminu:u,orderKey:p,basicItem:"none",milestone:"block",mileStoneNaglowek:"Milestone "+(i+a+1),milestoneUkonczoneZadaniaProcent:"0",milestoneWykorzystanyBudzetPieniadze:"0",milestoneWykorzystanyBudzetGodziny:"0",data:n,nazwa:m},r={idTerminu:u,orderKey:p,mileStoneNaglowek:"Milestone "+(i+a+1),data:n,nazwa:m};e.item.zadania.push(s),e.item.terminy.push(r),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}})}})}),e.RebuildTerms(),navi.popPage()},e.removeTerm=function(a){var t=n("filter")(e.item.terminy,{idTerminu:a},!0),i=e.item.terminy.indexOf(t[0]);e.item.terminy.splice(i,1),t=n("filter")(e.item.zadania,{idTerminu:a},!0),i=e.item.zadania.indexOf(t[0]),e.item.zadania.splice(i,1),$.ajax({type:"POST",url:o,data:{idTerminu:a,removeTerm:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){}})},e.logType=function(){ons.notification.confirm({title:"Opcje projektu",message:"co chcesz zrobić?",buttonLabels:["Wszystkie","Przekroczone terminy","Przekroczone budżety","Ukończone zadania","Utworzone zadania"],primaryButtonIndex:0,callback:function(t){0==t&&(a="wszystkie","$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()),1==t&&(a="przekroczonyTermin","$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()),2==t&&(a="przekroczonyBudzet","$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()),3==t&&(a="koniecZadania","$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()),4==t&&(a="noweZadanie","$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply())}})},e.addPersonToTask=function(a){if(e.currentuser[0].tmp){var t=n("filter")(e.currentuser[0].tmp,{idUser:a},!0);if(t.length>0)ons.notification.alert({message:"Ta osoba jest już dodana do tego zadania"});else{var i=n("filter")(e.item.przypisaneOsoby,{idUser:a},!0),o={idUser:i[0].idUser,imie:i[0].imie,email:i[0].email,avatar:i[0].avatar,stawka:i[0].stawka,iloscZadan:0,czasUzytkownika:"00:00",kasaUzytkownika:"0",punktyUzytkownika:0};e.currentuser[0].tmp.push(o),navi.popPage()}}else{var i=n("filter")(e.item.przypisaneOsoby,{idUser:a},!0),o={idUser:i[0].idUser,imie:i[0].imie,email:i[0].email,avatar:i[0].avatar,stawka:i[0].stawka,iloscZadan:0,czasUzytkownika:"00:00",kasaUzytkownika:"0",punktyUzytkownika:0};e.currentuser[0].tmp=[],e.currentuser[0].tmp.push(o),navi.popPage()}},e.removePersonFromTask=function(a){var t=n("filter")(e.currentuser[0].tmp,{idUser:a},!0),i=e.currentuser[0].tmp.indexOf(t[0]);e.currentuser[0].tmp.splice(i,1)},e.userAddedToTemp=function(a){if(e.currentuser[0].tmp){var t=n("filter")(e.currentuser[0].tmp,{idUser:a},!0);return t.length>0?!0:!1}return!1},e.addPromoPoints=function(a){ons.notification.confirm({title:"Punkty premiowe",message:"ile punktów chcesz dodać?",buttonLabels:["1","2","3","4","5"],primaryButtonIndex:0,callback:function(t){l=t+1,$('.actionButtonHolder[data-id="'+a+'"]').fadeOut(),e.item.log[a].przyznanePunkty=l;var i=e.item.przypisaneOsoby[e.item.log[a].idOsoby].punktyUzytkownika;e.item.przypisaneOsoby[e.item.log[a].idOsoby].punktyUzytkownika=i+l,$('.actionInfo[data-id="'+a+'"]').fadeIn(),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}})}}),e.controller("MasterController",function(e,a,t,i){e.items=a.items,e.user=t.items[0];var n=e.user.idUser;e.reloadProjects=function(){window.console&&console.log("test"),e.items=a.items,e.user=t.items[0]},e.$on("reloadProjectsEvent",function(a){e.reloadProjects()}),e.goToMojeZadania=function(){if(e.user.tasks){var a=e.user.tasks.length;angular.forEach(e.user.tasks,function(t,o){var n=i("filter")(e.items,{idProjekt:t.idProjekt},!0),s=i("filter")(n[0].przypisaneOsoby,{idUser:e.user.idUser},!0);t.tytul=n[0].tytul,t.czasUzytkownika=s[0].czasUzytkownika,t.kasaUzytkownika=s[0].kasaUzytkownika,t.punktyUzytkownika=s[0].punktyUzytkownika,0==t.czasUzytkownika?(t.statusUzytkownika="oczekuje",t.statusClass="completionHalf"):(t.statusUzytkownika="w trakcie",t.statusClass="completionHalf"),o+1==a&&($(".tabMojeZadania").css("display","block"),$(".tabProjekty").css("display","none"))})}else $(".tabMojeZadania").css("display","block"),$(".tabProjekty").css("display","none")},e.showDetailByID=function(t){var i=0;angular.forEach(a.items,function(a,o){a.idProjekt==t&&(i=o,e.showDetail(i))})},e.showDetail=function(t){var i=a.items[t];a.selectedItem=i,r=a.selectedItem.idProjekt;var n=0,s=0;i.zasoby&&angular.forEach(i.zasoby,function(e,a){$.ajax({type:"POST",url:o,data:{idZasob:e.idZasob,getReservations:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(a){e.rezerwacje=angular.fromJson(a).rezerwacje}})}),i.zadania&&(n=i.zadania.length,angular.forEach(i.zadania,function(a,t){s++,$.ajax({type:"POST",url:o,data:{idZadania:a.idZadania,getTaskDetails:""},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(o){a.przypisaneOsoby=angular.fromJson(o).osoby,"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply(),t==n-1&&e.navi.pushPage("procjectview.html",{title:i.tytul})}})}))},e.projectDetails=function(){angular.forEach(a.items,function(e,a){i("filter")(e.przypisaneOsoby,{idUser:n},!0)})}}),e.factory("$currentUser",function(){var e={};return e.items=[{imie:"Marcin",nazwisko:"Kowalski",idUser:456,avatar:"http://themina.net/themes/shema/img/demo/team/team_img_3.jpg",tmp:[],ostatnieOsoby:[{idUser:12,imie:"Piotr Kowalski",email:"piotr@kowalski.pl",avatar:"http://api.adorable.io/avatars/209/abott@3.io.png",stawka:20},{idUser:13,imie:"Marcin Kowalski",email:"marcin@kowalski.pl",avatar:"http://api.adorable.io/avatars/209/abott@4.io.png",stawka:20},{idUser:14,imie:"Dominik Kowalski",email:"dominik@kowalski.pl",avatar:"http://api.adorable.io/avatars/209/abott@44.io.png",stawka:50}]}],e}),e.factory("$projekty",function(){var e={};return e.items=[],e}),e.factory("$bazauzytkownikow",function(){var e={};return e.items=[],e})}();